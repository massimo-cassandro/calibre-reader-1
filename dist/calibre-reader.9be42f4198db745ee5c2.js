/*!
 * calibre-reader v.1.0.x - Massimo Cassandro 2023-2025
 */
"use strict";(globalThis.webpackChunkcalibre_reader=globalThis.webpackChunkcalibre_reader||[]).push([[661],{459:()=>{const e={result_wrapper:document.querySelector(".result-wrapper"),search_form:document.querySelector(".search-form"),observer_element:null,spinner_wrapper:document.querySelector(".spinner-wrapper"),orderByBtnsFset:document.querySelector(".search-options.orderBy"),filterBtnsFset:document.querySelector(".search-options.filter"),searchFieldsFset:document.querySelector(".searchFields"),covers_base_url:"./covers",get_data_url:new URL("/php/get-data.php",location.href),get_list_url:new URL("/php/get-list.php",location.href)};function t(e){const t=new Date(e);return t.getFullYear()+"-"+String(t.getMonth()+1).padStart(2,"0")+"-"+String(t.getDate()).padStart(2,"0")}function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"icon top-adjust dark",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return e=e.replace(/<svg/,`<svg class="${t}"`),a&&(e=e.replace(/<svg/,`<svg ${a}`)),e}let r={};const s={q:null,orderBy:null,authorId:null,pag:0,limit:20,serieId:null},n=new IntersectionObserver((e=>{e[0].isIntersecting&&(r.pag++,i(r))}),{threshold:0,rootMargin:"40px 0px"});async function i(){r={...s,...arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}},e.search_form.disabled=!0,e.spinner_wrapper.classList.remove("off");const i=await async function(){0===r.pag&&(window.scrollTo(0,0),e.result_wrapper.innerHTML="",e.observer_element?.remove(),e.observer_element=null);const t=e.get_data_url,a=t.searchParams;for(const e in r)r[e]&&a.set(e,r[e]);const s=await fetch(t.toString());return await s.json()}();i.length<r.limit&&e.observer_element&&(n.unobserve(e.observer_element),e.observer_element.remove(),e.observer_element=null),e.result_wrapper.insertAdjacentHTML("beforeend",i.map((r=>function(r){return r.authors=JSON.parse(r.authors),r.tags=JSON.parse(r.tags),`<article class="book${r.letto?" letto":""}">\n    <div class="book-inner">\n\n      <div class="book-cover">\n        ${+r.has_cover?`<img src="${e.covers_base_url}/${r.id}-minia.avif" alt="Cover" loading="lazy">`:""}\n      </div>\n\n      <div class="book-data">\n        <div class="author">\n          ${r.authors.map((e=>`<span role="button" data-author-id="${e.id}">${e.name}</span>`)).join(", ")}\n        </div>\n        <h2 class="title">${r.title}</h2>\n        ${r.serie?`<div class="serie" role="button" data-serie-id="${r.serie_id}"><span>${r.serie}</span> ${r.series_index}</div>`:""}\n        <div class="publisher">\n          ${r.prima_ediz?`<time title="Anno prima edizione">${r.prima_ediz}</time> / `:""}\n          ${r.publisher??"—"} ${r.pub_year&&"0101"!=r.pub_year?` (<time>${r.pub_year}</time>)`:""}\n        </div>\n\n        <div class="info">\n          ${r.tags.length?`<span class="tags-wrapper">\n              ${r.tags.length?`${a('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256"><path d="M243.31,136,144,36.69A15.86,15.86,0,0,0,132.69,32H40a8,8,0,0,0-8,8v92.69A15.86,15.86,0,0,0,36.69,144L136,243.31a16,16,0,0,0,22.63,0l84.68-84.68a16,16,0,0,0,0-22.63Zm-96,96L48,132.69V48h84.69L232,147.31ZM96,84A12,12,0,1,1,84,72,12,12,0,0,1,96,84Z"/></svg>')}&nbsp;<span class="tags">${r.tags.map((e=>`<span role="button" data-tag-id="${e.id}">${e.name}</span>`)).join("/")}</span>`:""}\n            </span>`:""}\n\n\n          ${r.timestamp?`<time class="text-muted text-nowrap" datetime="${t(r.timestamp)}">\n              ${a('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256"><path d="M208,32H184V24a8,8,0,0,0-16,0v8H88V24a8,8,0,0,0-16,0v8H48A16,16,0,0,0,32,48V208a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V48A16,16,0,0,0,208,32ZM72,48v8a8,8,0,0,0,16,0V48h80v8a8,8,0,0,0,16,0V48h24V80H48V48ZM208,208H48V96H208V208Z"/></svg>')}\n              ${new Date(r.timestamp).toLocaleString("it-IT",{year:"2-digit",month:"short",day:"numeric"})}\n            </time>`:""}\n\n          <span class="formats-wrapper">\n            ${a('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256"><path d="M213.66,82.34l-56-56A8,8,0,0,0,152,24H56A16,16,0,0,0,40,40V216a16,16,0,0,0,16,16H200a16,16,0,0,0,16-16V88A8,8,0,0,0,213.66,82.34ZM160,51.31,188.69,80H160ZM200,216H56V40h88V88a8,8,0,0,0,8,8h48V216Z"/></svg>')}\n            <span class="file-formats">${r.files_format??"&mdash;"}</span>\n          </span>\n\n        </div>\n\n        <div class="info">\n          ${r.amz?`${a('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256"><path d="M152,136a24,24,0,1,1-24-24A24,24,0,0,1,152,136Zm80-8A104,104,0,1,1,128,24,104.11,104.11,0,0,1,232,128Zm-80-24v0a40,40,0,1,0,0,64v0a8,8,0,0,0,16,0V104A40,40,0,0,0,94.13,82.71a8,8,0,0,0,13.54,8.52A24,24,0,0,1,152,104Zm44.81,65.61a8,8,0,0,0-11.2,1.58,72,72,0,0,1-115.22,0,8,8,0,1,0-12.78,9.62,88,88,0,0,0,140.78,0A8,8,0,0,0,196.81,169.61Z"/></svg>',"icon icon-lg top-adjust")}`:""}\n\n          ${r.data_lettura||r.rating?`<span>\n              ${r.data_lettura?a('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256"><path d="M200,40a8,8,0,0,0,0,16,16,16,0,0,1,16,16v58.08A44,44,0,0,0,145.68,152H110.32A44,44,0,0,0,40,130.08V72A16,16,0,0,1,56,56a8,8,0,0,0,0-16A32,32,0,0,0,24,72v92a44,44,0,0,0,87.81,4h32.38A44,44,0,0,0,232,164V72A32,32,0,0,0,200,40ZM68,192a28,28,0,1,1,28-28A28,28,0,0,1,68,192Zm120,0a28,28,0,1,1,28-28A28,28,0,0,1,188,192Z"/></svg>'):""}\n              <time class="text-muted mx-1" datetime=${t(r.data_lettura)}>${r.data_lettura?new Date(r.data_lettura).toLocaleString("it-IT",{year:"2-digit",month:"short",day:"numeric"}):""}</time>\n              <span class="rating">${r.rating?"★".repeat(r.rating):""}</span>\n            </span>`:""}\n\n          <span>\n            ${a('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256"><path d="M231.65,194.55,198.46,36.75a16,16,0,0,0-19-12.39L132.65,34.42a16.08,16.08,0,0,0-12.3,19l33.19,157.8A16,16,0,0,0,169.16,224a16.25,16.25,0,0,0,3.38-.36l46.81-10.06A16.09,16.09,0,0,0,231.65,194.55ZM136,50.15c0-.06,0-.09,0-.09l46.8-10,3.33,15.87L139.33,66Zm6.62,31.47,46.82-10.05,3.34,15.9L146,97.53Zm6.64,31.57,46.82-10.06,13.3,63.24-46.82,10.06ZM216,197.94l-46.8,10-3.33-15.87L212.67,182,216,197.85C216,197.91,216,197.94,216,197.94ZM104,32H56A16,16,0,0,0,40,48V208a16,16,0,0,0,16,16h48a16,16,0,0,0,16-16V48A16,16,0,0,0,104,32ZM56,48h48V64H56Zm0,32h48v96H56Zm48,128H56V192h48v16Z"/></svg>')}\n            <span class="scaffale">${r.scaffale?`<span role="button" data-scaffale-id="${r.scaffale_id}">${r.scaffale}</span>`:"—"}</span>\n          </span>\n\n        </div>\n      </div>\n\n      <div class="book-utils">\n        <a href="https://www.google.it/search?q=${encodeURIComponent(r.authors.map((e=>e.name)).join(", "))}" target="_blank" rel="noopener noreferrer">\n          ${a('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256"><path d="M228,128a100,100,0,1,1-22.86-63.64,12,12,0,0,1-18.51,15.28A76,76,0,1,0,203.05,140H128a12,12,0,0,1,0-24h88A12,12,0,0,1,228,128Z"/></svg>',"icon")}\n        </a>\n\n        <a href="https://www.amazon.it/s?k=${encodeURIComponent(r.authors.map((e=>e.name)).join(", "))}&i=digital-text" target="_blank" rel="noopener noreferrer">\n          ${a('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256"><path d="M252,168v32a12,12,0,0,1-24,0v-3.09C215.56,208.41,180.25,236,128,236c-64.6,0-103.3-42.18-104.92-44A12,12,0,1,1,40.92,176c.3.33,33.48,36,87.08,36,42.65,0,72.34-22.58,82.87-32H208a12,12,0,0,1,0-24h32A12,12,0,0,1,252,168ZM156,86.08V84A32,32,0,0,0,97.17,66.55a12,12,0,0,1-20.11-13.1A56,56,0,0,1,180,84v92a12,12,0,0,1-23.85,1.81A56,56,0,1,1,156,86.08ZM156,132a32,32,0,1,0-32,32A32,32,0,0,0,156,132Z"/></svg>',"icon")}\n        </a>\n      </div>\n\n    </div>\n\n    <div class="details-trigger">\n      <button type="button"${r.comment||r.has_cover?"":" disabled"}>\n        ${a(r.comment||!r.comment&&!r.has_cover?'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256"><path d="M116,120a12,12,0,1,1,12,12A12,12,0,0,1,116,120ZM84,132a12,12,0,1,0-12-12A12,12,0,0,0,84,132Zm88,0a12,12,0,1,0-12-12A12,12,0,0,0,172,132Zm60-76V184a16,16,0,0,1-16,16H155.57l-13.68,23.94a16,16,0,0,1-27.78,0L100.43,200H40a16,16,0,0,1-16-16V56A16,16,0,0,1,40,40H216A16,16,0,0,1,232,56Zm-16,0H40V184h65.07a8,8,0,0,1,7,4l16,28,16-28a8,8,0,0,1,7-4H216Z"/></svg>':'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256"><path d="M216,40H40A16,16,0,0,0,24,56V200a16,16,0,0,0,16,16H216a16,16,0,0,0,16-16V56A16,16,0,0,0,216,40Zm0,16V158.75l-26.07-26.06a16,16,0,0,0-22.63,0l-20,20-44-44a16,16,0,0,0-22.62,0L40,149.37V56ZM40,172l52-52,80,80H40Zm176,28H194.63l-36-36,20-20L216,181.38V200ZM144,100a12,12,0,1,1,12,12A12,12,0,0,1,144,100Z"/></svg>',"icon")}\n      </button>\n    </div>\n    ${r.comment||r.has_cover?`<section class="details">\n      <div>\n      ${r.comment??""}\n      ${+r.has_cover?`<div class="cover"><img src="${e.covers_base_url}/${r.id}.avif" alt="Cover" loading="lazy"></div>`:""}\n      </div>\n    </section>`:""}\n  </article>`}(r))).join("")),i.length<r.limit&&e.result_wrapper.insertAdjacentHTML("beforeend",'<div class="bookend"><img src="/favicon.svg" alt=""></div>'),e.observer_element||i.length!==r.limit||(e.result_wrapper.insertAdjacentHTML("afterend",'<div id="observer" class="p-1"></div>'),e.observer_element=document.getElementById("observer"),n.observe(e.observer_element)),e.spinner_wrapper.classList.add("off"),e.search_form.disabled=!1}let o={},l=null;const c=e.search_form.querySelector(".search-input"),d=e.search_form.querySelector(".search-info"),p=async()=>{d.innerHTML=l?`<em>Ricerca per</em><br>${l.type}: <strong>${l.value}</strong>`:"";const t=document.querySelector(".search-options input:checked")?.value??null;await i({...o,orderBy:t}),e.spinner_wrapper.classList.add("off"),e.search_form.disabled=!1,e.orderByBtnsFset.disabled=!1,e.searchFieldsFset.disabled=!1,Array.from(e.filterBtnsFset.querySelectorAll('input[type="radio"]'),(e=>e.checked=!1))},v=async e=>{o=e?{}:{q:c.value.trim()},l=null,e&&c.focus({focusVisible:!0}),await p()};e.search_form.querySelector(".search-btn").addEventListener("click",(()=>{v()}),!1),c.addEventListener("keydown",(e=>{"Enter"===e.code&&v()}),!1),e.search_form.querySelector(".reset-btn").addEventListener("click",(()=>{c.value="",e.result_wrapper.innerHTML="",e.search_form.querySelector('[type="radio"]:first-of-type').checked=!0,v(!0)}),!1),e.result_wrapper.addEventListener("click",(e=>{"reset-filter"===e.target.id&&p()}),!1),e.orderByBtnsFset.addEventListener("click",(e=>{if(e.target.classList.contains("orderBy-btn")){document.getElementById(e.target.getAttribute("for")).checked=!0,p()}}),!1),e.filterBtnsFset.addEventListener("click",(t=>{if(t.target.classList.contains("filter-btn")){const a=document.getElementById(t.target.getAttribute("for"));a.checked=!0,function(t){e.search_form.disabled=!0,e.spinner_wrapper.classList.remove("off"),e.observer_element?.remove(),e.result_wrapper.innerHTML="";const a=e.get_list_url,r=new URLSearchParams(a.search);r.set("l",t),a.search=r.toString(),(async()=>{const e=await fetch(a);return await e.json()})().then((a=>{e.result_wrapper.innerHTML='<p class="text-center mt-1"><button class="btn btn-outline" type="button" id="reset-filter">Annulla</button></p><ul class="list">'+a.map((e=>`<li role="button" data-${t}-id="${e.id}">${e.name}</li>`)).join("")+"</ul>",e.spinner_wrapper.classList.add("off"),e.search_form.disabled=!1,e.orderByBtnsFset.disabled=!0,e.searchFieldsFset.disabled=!0})).catch((e=>{console.error(a),console.error(e),alert("Si è verificato un errore (getList)")}))}(a.value)}}),!1),e.result_wrapper.addEventListener("click",(e=>{if(e.target.hasAttribute("data-author-id")&&(document.getElementById("orderBy-year").click(),l={type:"autore",value:e.target.innerText},o={authorId:+e.target.dataset.authorId},c.value="",p()),e.target.closest("[data-serie-id]")){const t=e.target.closest("[data-serie-id]");document.getElementById("orderBy-serie").click(),l={type:"serie",value:t.closest("[data-serie-id]").querySelector("span").innerText},o={serieId:+t.dataset.serieId},c.value="",p()}if(e.target.hasAttribute("data-tag-id")&&(l={type:"tag",value:e.target.innerText},o={tagId:+e.target.dataset.tagId},c.value="",p()),e.target.hasAttribute("data-scaffale-id")&&(document.getElementById("orderBy-serie").click(),l={type:"scaffale",value:e.target.innerText},o={scaffaleId:+e.target.dataset.scaffaleId},c.value="",p()),e.target.closest(".details-trigger")){const t=e.target.closest(".book"),a=t.querySelector(".details");getComputedStyle(a).getPropertyValue("--details-height")||a.style.setProperty("--details-height",function(e){if(!e?.cloneNode)return null;const t=e.cloneNode(!0);Object.assign(t.style,{overflow:"visible",height:"auto",maxHeight:"none",opacity:"0",visibility:"hidden",display:"block"}),e.after(t);const a=t.offsetHeight;return t.remove(),a}(a)+"px"),t.classList.toggle("details-on")}}),!1),p()}},e=>{var t;t=459,e(e.s=t)}]);